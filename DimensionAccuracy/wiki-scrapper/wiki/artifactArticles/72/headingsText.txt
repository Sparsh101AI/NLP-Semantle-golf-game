Finite state machine with datapath
References